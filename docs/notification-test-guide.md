# お知らせ機能テストガイド

**最終更新日**: 2025-01-21
**対象**: システム管理者
**所要時間**: 約10-15分

---

## 📋 概要

このガイドでは、お知らせ機能が正しく動作するかテストする手順を説明します。

### 前提条件

- ✅ Supabase テーブルが作成済み (`notifications`, `notification_reads`)
- ✅ 管理者アカウントでログイン済み
- ✅ `/admin-notifications.html` にアクセス可能

---

## 🧪 テスト1: お知らせの作成

### ステップ1: お知らせ管理画面にアクセス

1. 管理画面にログイン: `/admin.html`
2. 「お知らせ管理」カードをクリック
3. `/admin-notifications.html` が開く

### ステップ2: 新規お知らせを作成

1. **「新規お知らせ作成」** ボタンをクリック

2. **基本情報を入力:**

| フィールド | 値 | 説明 |
|-----------|-----|------|
| タイトル | `LIFE X ポータルサイトへようこそ` | お知らせのタイトル |
| 内容 | `LIFE X 加盟店専用ポータルサイトをご利用いただきありがとうございます。こちらでプラン情報、ダウンロード資料、FAQ などをご確認いただけます。` | お知らせ本文 |

3. **カテゴリを選択:**
   - 選択: **システム** (system)
   - 色: 赤色で表示される

4. **優先度を選択:**
   - 選択: **高** (high)
   - 結果: 「重要」バッジが表示される

5. **ステータスを選択:**
   - 選択: **公開** (published)
   - 注: 「下書き」を選択するとTOP画面に表示されません

6. **対象ロールを選択:**
   - 選択: **全員** (all)
   - 管理者とメンバー両方に表示される

7. **公開日時:**
   - 自動的に現在日時が設定される
   - 必要に応じて変更可能

8. **有効期限（オプション）:**
   - 空欄のまま（期限なし）

9. **「保存」** ボタンをクリック

### ステップ3: 作成確認

- お知らせ一覧に追加されていることを確認
- ステータスが「公開中」になっていることを確認

---

## 🧪 テスト2: カテゴリ別お知らせの作成

異なるカテゴリのお知らせを作成して、色分け表示をテストします。

### プラン関連のお知らせ

| フィールド | 値 |
|-----------|-----|
| タイトル | `新プラン追加のお知らせ` |
| 内容 | `30坪タイプの新しいプランが追加されました。詳細はプラン一覧ページをご確認ください。` |
| カテゴリ | **プラン** (plan) |
| 優先度 | **通常** (normal) |
| ステータス | **公開** (published) |
| 対象ロール | **全員** (all) |

**期待される表示:** 青色のカテゴリバッジ

### ダウンロード関連のお知らせ

| フィールド | 値 |
|-----------|-----|
| タイトル | `2025年度 資金計画書テンプレート公開` |
| 内容 | `2025年度版の資金計画書テンプレートをダウンロードページに追加しました。` |
| カテゴリ | **ダウンロード** (download) |
| 優先度 | **通常** (normal) |
| ステータス | **公開** (published) |
| 対象ロール | **全員** (all) |

**期待される表示:** 紫色のカテゴリバッジ

### ルール関連のお知らせ

| フィールド | 値 |
|-----------|-----|
| タイトル | `営業ルール更新のお知らせ` |
| 内容 | `営業活動に関するガイドラインを更新しました。必ずご確認ください。` |
| カテゴリ | **ルール** (rule) |
| 優先度 | **高** (high) |
| ステータス | **公開** (published) |
| 対象ロール | **全員** (all) |

**期待される表示:** 緑色のカテゴリバッジ + 「重要」バッジ

---

## 🧪 テスト3: TOP画面での表示確認

### ステップ1: TOP画面にアクセス

1. ブラウザで新しいタブを開く
2. `/` (TOP画面) にアクセス

### ステップ2: お知らせセクションを確認

**期待される表示:**

```
お知らせ
┌─────────────────────────────────────────┐
│ [システム] [重要] 2025年1月21日          │
│ LIFE X ポータルサイトへようこそ          │
│ LIFE X 加盟店専用ポータルサイトを...    │
└─────────────────────────────────────────┘

┌─────────────────────────────────────────┐
│ [ルール] [重要] 2025年1月21日            │
│ 営業ルール更新のお知らせ                  │
│ 営業活動に関するガイドラインを...        │
└─────────────────────────────────────────┘

┌─────────────────────────────────────────┐
│ [プラン] 2025年1月21日                   │
│ 新プラン追加のお知らせ                    │
│ 30坪タイプの新しいプランが...           │
└─────────────────────────────────────────┘
```

### ステップ3: カテゴリ色を確認

| カテゴリ | 期待される色 | 実際の表示 |
|---------|------------|-----------|
| プラン | 青 (bg-blue-100) | [ ] 確認 |
| ルール | 緑 (bg-green-100) | [ ] 確認 |
| ダウンロード | 紫 (bg-purple-100) | [ ] 確認 |
| FAQ | オレンジ (bg-orange-100) | [ ] 確認 |
| システム | 赤 (bg-red-100) | [ ] 確認 |
| 一般 | グレー (bg-gray-100) | [ ] 確認 |

### ステップ4: 優先度バッジを確認

- [ ] 優先度「高」のお知らせに「重要」バッジが表示される
- [ ] 優先度「通常」のお知らせに「重要」バッジが表示されない

---

## 🧪 テスト4: 未読バッジ機能

### ステップ1: 未読バッジの表示確認

1. TOP画面にアクセス
2. ヘッダーのナビゲーションメニュー「ホーム」を確認
3. 赤い丸バッジに数字が表示されることを確認

**期待される表示:**
```
ホーム [3]  ← 赤い丸バッジに未読数「3」が表示
```

### ステップ2: 未読数の計算確認

- お知らせが3件 → バッジ数は「3」
- お知らせが0件 → バッジは非表示
- お知らせが100件以上 → バッジ数は「99+」

### ステップ3: モバイル表示確認

1. ブラウザの開発者ツールを開く (F12)
2. デバイスツールバーを表示 (Ctrl + Shift + M)
3. モバイルビューに切り替え
4. ハンバーガーメニューをクリック
5. モバイルメニュー内の「ホーム」にもバッジが表示されることを確認

---

## 🧪 テスト5: お知らせの編集・削除

### 編集テスト

1. `/admin-notifications.html` に戻る
2. お知らせ一覧から任意のお知らせの **「編集」** をクリック
3. タイトルを変更: `[テスト編集] ` を先頭に追加
4. **「保存」** をクリック
5. TOP画面で変更が反映されることを確認

### 下書き保存テスト

1. 新規お知らせを作成
2. ステータスを **「下書き」** に設定
3. **「保存」** をクリック
4. お知らせ一覧で「下書き」ステータスになることを確認
5. TOP画面に表示されないことを確認

### 削除テスト

1. テスト用お知らせの **「削除」** ボタンをクリック
2. 確認ダイアログで **「削除」** を選択
3. お知らせ一覧から削除されることを確認
4. TOP画面から削除されることを確認

---

## 🧪 テスト6: 対象ロール別表示

### 管理者専用お知らせ

1. 新規お知らせを作成
2. 対象ロールを **「管理者のみ」** に設定
3. 管理者アカウントでTOP画面を確認 → 表示される ✅
4. メンバーアカウントでTOP画面を確認 → 表示されない ✅

### メンバー専用お知らせ

1. 新規お知らせを作成
2. 対象ロールを **「メンバーのみ」** に設定
3. メンバーアカウントでTOP画面を確認 → 表示される ✅
4. 管理者アカウントでTOP画面を確認 → 表示されない ✅

---

## 🧪 テスト7: 有効期限機能

### 期限切れお知らせ

1. 新規お知らせを作成
2. 有効期限を **昨日の日付** に設定
3. **「保存」** をクリック
4. TOP画面でお知らせが表示されないことを確認

### 期限内お知らせ

1. 新規お知らせを作成
2. 有効期限を **1週間後** に設定
3. **「保存」** をクリック
4. TOP画面でお知らせが表示されることを確認

---

## ✅ 最終確認チェックリスト

### お知らせ管理画面

- [ ] お知らせの作成ができる
- [ ] お知らせの編集ができる
- [ ] お知らせの削除ができる
- [ ] 下書き保存ができる
- [ ] ステータス変更（公開/下書き/アーカイブ）ができる

### TOP画面表示

- [ ] 公開済みお知らせが最大3件表示される
- [ ] カテゴリ別に色分けされている
- [ ] 優先度「高」に「重要」バッジが表示される
- [ ] 日付が正しく表示される
- [ ] お知らせがない場合「お知らせはありません」が表示される

### 未読バッジ

- [ ] ナビゲーションメニューに未読数が表示される
- [ ] 未読数が正しくカウントされる
- [ ] モバイルメニューにも表示される
- [ ] 100件以上の場合「99+」と表示される

### フィルタリング

- [ ] 対象ロール別に正しく表示される
- [ ] 有効期限が正しく機能する
- [ ] ステータスが「公開」のみ表示される

### レスポンシブ

- [ ] デスクトップで正しく表示される
- [ ] タブレットで正しく表示される
- [ ] モバイルで正しく表示される

---

## 🚨 トラブルシューティング

### 問題1: お知らせが表示されない

**チェック項目:**
- [ ] ステータスが「公開」になっているか
- [ ] 有効期限が切れていないか
- [ ] 対象ロールが正しく設定されているか
- [ ] 公開日時が未来になっていないか

**解決策:**
```javascript
// ブラウザのコンソールで確認
window.supabase
    .from('notifications')
    .select('*')
    .then(console.log);
```

### 問題2: 未読バッジが表示されない

**チェック項目:**
- [ ] `notification_reads` テーブルが作成されているか
- [ ] Supabase接続が正常か
- [ ] ブラウザのコンソールにエラーが出ていないか

**解決策:**
```javascript
// ブラウザのコンソールで確認
document.querySelectorAll('.notification-badge');
// 要素が存在するか確認
```

### 問題3: カテゴリ色が表示されない

**原因**: Tailwind CSSクラスが適用されていない

**解決策:**
- ブラウザのキャッシュをクリア (Ctrl + Shift + R)
- Tailwind CDNが読み込まれているか確認

---

## 📊 テスト結果の記録

テスト実施後、以下のフォーマットで記録してください:

```markdown
## テスト結果 - 2025-01-21

### テスト環境
- ブラウザ: Chrome 120
- デバイス: デスクトップ
- URL: https://lifex-btob.vercel.app

### テスト結果
- [✅] お知らせの作成
- [✅] TOP画面表示
- [✅] 未読バッジ
- [✅] カテゴリ色分け
- [⚠️] 対象ロール別表示（メンバーアカウント未作成のため未テスト）

### 問題点
- なし

### 備考
- 全機能が正常に動作することを確認
```

---

## 🎉 テスト完了後

全てのテストが完了したら:

1. **テストデータのクリーンアップ（オプション）:**
   - テスト用お知らせを削除
   - 本番用お知らせのみ残す

2. **本番データの準備:**
   - 実際のお知らせを作成
   - 有効期限を設定
   - 対象ロールを正しく設定

3. **ユーザーへの案内:**
   - 加盟店にポータルサイトのURLを共有
   - ログイン方法を案内
   - お知らせ確認方法を説明

---

**次のステップ**: 全ての機能が正常に動作することを確認したら、加盟店アカウントを作成して実運用を開始してください。

詳細は `docs/admin-account-setup.md` の「追加ユーザー作成」セクションを参照してください。
