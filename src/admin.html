<!DOCTYPE html>
<html lang="ja" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>管理メニュー | LIFE X 管理画面</title>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            200: '#bfdbfe',
                            300: '#93c5fd',
                            400: '#60a5fa',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                            800: '#1e40af',
                            900: '#1e3a8a',
                        }
                    },
                    boxShadow: {
                        'soft': '0 2px 15px -3px rgba(0, 0, 0, 0.07), 0 10px 20px -2px rgba(0, 0, 0, 0.04)',
                        'hover': '0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)',
                        'card': '0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)',
                    }
                }
            }
        }
    </script>

    <link href="./styles/main.css" rel="stylesheet">
    <script src="/js/common.js"></script>

    <!-- Supabase Auth Guard -->
    <script type="module" src="/js/auth-guard.js"></script>

    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>

</head>
<body class="h-full bg-gradient-to-br from-gray-50 to-gray-100">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <a href="/" class="text-xl font-bold text-gray-900 hover:text-gray-700">LIFE X</a>
                    <span class="ml-2 px-2 py-1 bg-red-100 text-red-800 text-xs rounded-full">管理者専用</span>
                </div>
                <nav class="hidden md:flex space-x-8 items-center">
                    <a href="/admin.html" class="nav-link">管理ホーム</a>
                    <a href="/admin-plans.html" class="nav-link">プラン管理</a>
                    <a href="/admin-rules.html" class="nav-link">ルール・ガイドライン管理</a>
                    <a href="/admin-downloads.html" class="nav-link">ダウンロード管理</a>
                    <a href="/admin-faq.html" class="nav-link">よくある質問管理</a>
                    <a href="/admin-notifications.html" class="nav-link">お知らせ管理</a>
                    <a href="/admin-users.html" class="nav-link">ユーザー管理</a>
                    <a href="/admin-profile.html" class="nav-link">プロフィール</a>
                    <a href="/admin-system.html" class="nav-link">システム管理</a>
                    <a href="/admin-report.html" class="nav-link">レポート</a>
                    <a href="/" class="nav-link">サイトに戻る</a>
                    <button onclick="logout()" type="button" class="nav-link text-red-600 hover:text-red-800">ログアウト</button>
                </nav>

                <!-- Mobile Menu -->
                <div class="md:hidden" x-data="{ mobileMenuOpen: false }">
                    <button @click="mobileMenuOpen = !mobileMenuOpen" type="button" class="text-gray-500 hover:text-gray-600">
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                    </button>

                    <div x-show="mobileMenuOpen" class="absolute top-16 right-4 bg-white shadow-lg rounded-lg border border-gray-200 p-4 z-50 min-w-48">
                        <a href="/admin.html" class="block py-2 text-sm text-gray-900 font-medium">管理ホーム</a>
                        <a href="/admin-plans.html" class="block py-2 text-sm text-gray-600">プラン管理</a>
                        <a href="/admin-rules.html" class="block py-2 text-sm text-gray-600">ルール・ガイドライン管理</a>
                        <a href="/admin-downloads.html" class="block py-2 text-sm text-gray-600">ダウンロード管理</a>
                        <a href="/admin-faq.html" class="block py-2 text-sm text-gray-600">よくある質問管理</a>
                        <a href="/admin-notifications.html" class="block py-2 text-sm text-gray-600">お知らせ管理</a>
                        <a href="/admin-users.html" class="block py-2 text-sm text-gray-600">ユーザー管理</a>
                        <a href="/admin-profile.html" class="block py-2 text-sm text-gray-600">プロフィール</a>
                        <a href="/admin-system.html" class="block py-2 text-sm text-gray-600">システム管理</a>
                        <a href="/admin-report.html" class="block py-2 text-sm text-gray-600">レポート</a>
                        <div class="border-t border-gray-200 mt-3 pt-3">
                            <a href="/" class="block py-2 text-sm text-gray-600">サイトに戻る</a>
                            <button onclick="logout()" type="button" class="block py-2 text-sm text-red-600 hover:text-red-800 text-left w-full">ログアウト</button>
                        </div>
                    </div>
                </div>
                
                <div id="userInfo" class="hidden md:block text-sm"></div>
            </div>
        </div>
    </header>

    <div x-data="adminMenu()" x-init="init()">
        <!-- Page Header -->
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
            <div class="text-center mb-12">
                <h1 class="text-4xl font-bold text-gray-900 mb-4">管理者専用画面</h1>
                <p class="text-lg text-gray-600">管理したい項目を選択してください</p>
            </div>

            <!-- Admin Menu Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 max-w-7xl mx-auto">
                <!-- プラン管理 -->
                <a href="/admin-plans.html" 
                   class="group relative bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-2">
                    <div class="p-8">
                        <!-- Icon -->
                        <div class="w-20 h-20 mx-auto mb-6 bg-gradient-to-br from-blue-400 to-blue-600 rounded-2xl flex items-center justify-center group-hover:scale-110 transition-transform duration-300">
                            <svg class="w-10 h-10 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                            </svg>
                        </div>
                        
                        <!-- Title & Description -->
                        <h3 class="text-xl font-bold text-gray-900 mb-3 text-center">プラン管理</h3>
                        <p class="text-gray-600 text-sm text-center mb-4">住宅プランの追加・編集・削除</p>
                        
                        <!-- Stats -->
                        <div class="flex justify-center space-x-6 pt-4 border-t border-gray-100">
                            <div class="text-center">
                                <div class="text-2xl font-bold text-blue-600" x-text="stats.plans"></div>
                                <div class="text-xs text-gray-500">登録プラン</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-gray-900" x-text="stats.plansUpdated"></div>
                                <div class="text-xs text-gray-500">今月更新</div>
                            </div>
                        </div>
                        
                        <!-- Arrow -->
                        <div class="absolute bottom-4 right-4 text-gray-400 group-hover:text-blue-600 transition-colors">
                            <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                            </svg>
                        </div>
                    </div>
                </a>

                <!-- ルール管理 -->
                <a href="/admin-rules.html" 
                   class="group relative bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-2">
                    <div class="p-8">
                        <!-- Icon -->
                        <div class="w-20 h-20 mx-auto mb-6 bg-gradient-to-br from-emerald-400 to-emerald-600 rounded-2xl flex items-center justify-center group-hover:scale-110 transition-transform duration-300">
                            <svg class="w-10 h-10 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                            </svg>
                        </div>
                        
                        <!-- Title & Description -->
                        <h3 class="text-xl font-bold text-gray-900 mb-3 text-center">ルール・ガイドライン管理</h3>
                        <p class="text-gray-600 text-sm text-center mb-4">加盟店ルールの設定・更新</p>
                        
                        <!-- Stats -->
                        <div class="flex justify-center space-x-6 pt-4 border-t border-gray-100">
                            <div class="text-center">
                                <div class="text-2xl font-bold text-emerald-600" x-text="stats.rules"></div>
                                <div class="text-xs text-gray-500">有効ルール</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-gray-900" x-text="stats.rulesRequired"></div>
                                <div class="text-xs text-gray-500">必須項目</div>
                            </div>
                        </div>
                        
                        <!-- Arrow -->
                        <div class="absolute bottom-4 right-4 text-gray-400 group-hover:text-emerald-600 transition-colors">
                            <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                            </svg>
                        </div>
                    </div>
                </a>

                <!-- ダウンロード管理 -->
                <a href="/admin-downloads.html" 
                   class="group relative bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-2">
                    <div class="p-8">
                        <!-- Icon -->
                        <div class="w-20 h-20 mx-auto mb-6 bg-gradient-to-br from-purple-400 to-purple-600 rounded-2xl flex items-center justify-center group-hover:scale-110 transition-transform duration-300">
                            <svg class="w-10 h-10 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10" />
                            </svg>
                        </div>
                        
                        <!-- Title & Description -->
                        <h3 class="text-xl font-bold text-gray-900 mb-3 text-center">ダウンロード管理</h3>
                        <p class="text-gray-600 text-sm text-center mb-4">資料・ドキュメントの管理</p>
                        
                        <!-- Stats -->
                        <div class="flex justify-center space-x-6 pt-4 border-t border-gray-100">
                            <div class="text-center">
                                <div class="text-2xl font-bold text-purple-600" x-text="stats.downloads"></div>
                                <div class="text-xs text-gray-500">総ファイル</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-gray-900" x-text="stats.downloadsMonth"></div>
                                <div class="text-xs text-gray-500">今月DL数</div>
                            </div>
                        </div>
                        
                        <!-- Arrow -->
                        <div class="absolute bottom-4 right-4 text-gray-400 group-hover:text-purple-600 transition-colors">
                            <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                            </svg>
                        </div>
                    </div>
                </a>

                <!-- よくある質問管理 -->
                <a href="/admin-faq.html" 
                   class="group relative bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-2">
                    <div class="p-8">
                        <!-- Icon -->
                        <div class="w-20 h-20 mx-auto mb-6 bg-gradient-to-br from-amber-400 to-amber-600 rounded-2xl flex items-center justify-center group-hover:scale-110 transition-transform duration-300">
                            <svg class="w-10 h-10 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </div>
                        
                        <!-- Title & Description -->
                        <h3 class="text-xl font-bold text-gray-900 mb-3 text-center">よくある質問管理</h3>
                        <p class="text-gray-600 text-sm text-center mb-4">FAQの追加・編集・管理</p>
                        
                        <!-- Stats -->
                        <div class="flex justify-center space-x-6 pt-4 border-t border-gray-100">
                            <div class="text-center">
                                <div class="text-2xl font-bold text-amber-600" x-text="stats.faqs"></div>
                                <div class="text-xs text-gray-500">登録FAQ</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-gray-900" x-text="stats.faqCategories"></div>
                                <div class="text-xs text-gray-500">カテゴリ数</div>
                            </div>
                        </div>
                        
                        <!-- Arrow -->
                        <div class="absolute bottom-4 right-4 text-gray-400 group-hover:text-amber-600 transition-colors">
                            <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                            </svg>
                        </div>
                    </div>
                </a>

                <!-- お知らせ管理 -->
                <a href="/admin-notifications.html"
                   class="group relative bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-2">
                    <div class="p-8">
                        <!-- Icon -->
                        <div class="w-20 h-20 mx-auto mb-6 bg-gradient-to-br from-cyan-400 to-cyan-600 rounded-2xl flex items-center justify-center group-hover:scale-110 transition-transform duration-300">
                            <svg class="w-10 h-10 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-1.234 9.168-3v14c-1.543-1.766-5.067-3-9.168-3H7a3.988 3.988 0 01-1.564-.317z" />
                            </svg>
                        </div>

                        <!-- Title & Description -->
                        <h3 class="text-xl font-bold text-gray-900 mb-3 text-center">お知らせ管理</h3>
                        <p class="text-gray-600 text-sm text-center mb-4">お知らせの作成・編集・配信</p>

                        <!-- Stats -->
                        <div class="flex justify-center space-x-6 pt-4 border-t border-gray-100">
                            <div class="text-center">
                                <div class="text-2xl font-bold text-cyan-600" x-text="stats.notifications || 0"></div>
                                <div class="text-xs text-gray-500">公開中</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-gray-900" x-text="stats.notificationsDraft || 0"></div>
                                <div class="text-xs text-gray-500">下書き</div>
                            </div>
                        </div>

                        <!-- Arrow -->
                        <div class="absolute bottom-4 right-4 text-gray-400 group-hover:text-cyan-600 transition-colors">
                            <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                            </svg>
                        </div>
                    </div>
                </a>

                <!-- ユーザー管理 -->
                <a href="/admin-users.html"
                   class="group relative bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-2">
                    <div class="p-8">
                        <!-- Icon -->
                        <div class="w-20 h-20 mx-auto mb-6 bg-gradient-to-br from-teal-400 to-teal-600 rounded-2xl flex items-center justify-center group-hover:scale-110 transition-transform duration-300">
                            <svg class="w-10 h-10 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
                            </svg>
                        </div>

                        <!-- Title & Description -->
                        <h3 class="text-xl font-bold text-gray-900 mb-3 text-center">ユーザー管理</h3>
                        <p class="text-gray-600 text-sm text-center mb-4">加盟店アカウントの管理</p>

                        <!-- Stats -->
                        <div class="flex justify-center space-x-6 pt-4 border-t border-gray-100">
                            <div class="text-center">
                                <div class="text-2xl font-bold text-teal-600" x-text="stats.users || 0"></div>
                                <div class="text-xs text-gray-500">総ユーザー</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-gray-900" x-text="stats.activeUsers || 0"></div>
                                <div class="text-xs text-gray-500">有効</div>
                            </div>
                        </div>

                        <!-- Arrow -->
                        <div class="absolute bottom-4 right-4 text-gray-400 group-hover:text-teal-600 transition-colors">
                            <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                            </svg>
                        </div>
                    </div>
                </a>

                <!-- プロフィール -->
                <a href="/admin-profile.html"
                   class="group relative bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-2">
                    <div class="p-8">
                        <!-- Icon -->
                        <div class="w-20 h-20 mx-auto mb-6 bg-gradient-to-br from-pink-400 to-pink-600 rounded-2xl flex items-center justify-center group-hover:scale-110 transition-transform duration-300">
                            <svg class="w-10 h-10 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                            </svg>
                        </div>

                        <!-- Title & Description -->
                        <h3 class="text-xl font-bold text-gray-900 mb-3 text-center">プロフィール</h3>
                        <p class="text-gray-600 text-sm text-center mb-4">アカウント情報・設定変更</p>

                        <!-- Stats -->
                        <div class="flex justify-center space-x-6 pt-4 border-t border-gray-100">
                            <div class="text-center">
                                <div class="text-2xl font-bold text-pink-600">-</div>
                                <div class="text-xs text-gray-500">最終ログイン</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-gray-900">-</div>
                                <div class="text-xs text-gray-500">ログイン回数</div>
                            </div>
                        </div>

                        <!-- Arrow -->
                        <div class="absolute bottom-4 right-4 text-gray-400 group-hover:text-pink-600 transition-colors">
                            <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                            </svg>
                        </div>
                    </div>
                </a>

                <!-- システム管理 -->
                <a href="/admin-system.html" 
                   class="group relative bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-2">
                    <div class="p-8">
                        <!-- Icon -->
                        <div class="w-20 h-20 mx-auto mb-6 bg-gradient-to-br from-rose-400 to-rose-600 rounded-2xl flex items-center justify-center group-hover:scale-110 transition-transform duration-300">
                            <svg class="w-10 h-10 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                            </svg>
                        </div>
                        
                        <!-- Title & Description -->
                        <h3 class="text-xl font-bold text-gray-900 mb-3 text-center">システム管理</h3>
                        <p class="text-gray-600 text-sm text-center mb-4">管理者・システム設定</p>
                        
                        <!-- Stats -->
                        <div class="flex justify-center space-x-6 pt-4 border-t border-gray-100">
                            <div class="text-center">
                                <div class="text-2xl font-bold text-rose-600" x-text="stats.admins"></div>
                                <div class="text-xs text-gray-500">管理者数</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-gray-900" x-text="stats.lastBackup"></div>
                                <div class="text-xs text-gray-500">前回バックアップ</div>
                            </div>
                        </div>
                        
                        <!-- Arrow -->
                        <div class="absolute bottom-4 right-4 text-gray-400 group-hover:text-rose-600 transition-colors">
                            <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                            </svg>
                        </div>
                    </div>
                </a>

                <!-- レポート -->
                <a href="/admin-report.html" 
                   class="group relative bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-2">
                    <div class="p-8">
                        <!-- Icon -->
                        <div class="w-20 h-20 mx-auto mb-6 bg-gradient-to-br from-indigo-400 to-indigo-600 rounded-2xl flex items-center justify-center group-hover:scale-110 transition-transform duration-300">
                            <svg class="w-10 h-10 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                            </svg>
                        </div>
                        
                        <!-- Title & Description -->
                        <h3 class="text-xl font-bold text-gray-900 mb-3 text-center">レポート</h3>
                        <p class="text-gray-600 text-sm text-center mb-4">アクセス解析・統計</p>
                        
                        <!-- Stats -->
                        <div class="flex justify-center space-x-6 pt-4 border-t border-gray-100">
                            <div class="text-center">
                                <div class="text-2xl font-bold text-indigo-600" x-text="stats.monthlyPV"></div>
                                <div class="text-xs text-gray-500">今月PV</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-gray-900" x-text="stats.downloadsMonth"></div>
                                <div class="text-xs text-gray-500">今月DL</div>
                            </div>
                        </div>
                        
                        <!-- Arrow -->
                        <div class="absolute bottom-4 right-4 text-gray-400 group-hover:text-indigo-600 transition-colors">
                            <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                            </svg>
                        </div>
                    </div>
                </a>
            </div>

            <!-- Data Recovery Section -->
            <div class="mt-12 max-w-5xl mx-auto">
                <div class="bg-white rounded-xl shadow-sm p-8">
                    <h3 class="text-xl font-semibold text-gray-900 mb-6 flex items-center">
                        <svg class="w-6 h-6 mr-3 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s8-1.79 8-4" />
                        </svg>
                        データバックアップ・復元
                    </h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <!-- Backup Section -->
                        <div class="space-y-4">
                            <h4 class="font-medium text-gray-900">データバックアップ</h4>
                            <p class="text-sm text-gray-600">プランデータと画像をJSONファイルとしてバックアップします。</p>
                            <button type="button"
                                @click="createBackup()"
                                :disabled="loading"
                                class="w-full bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors">
                                <span x-show="!loading">バックアップを作成</span>
                                <span x-show="loading">作成中...</span>
                            </button>
                        </div>
                        
                        <!-- Restore Section -->
                        <div class="space-y-4">
                            <h4 class="font-medium text-gray-900">データ復元</h4>
                            <p class="text-sm text-gray-600">バックアップファイルからデータを復元します。</p>
                            <input 
                                type="file" 
                                accept=".json"
                                @change="handleRestoreFile($event)"
                                class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-medium file:bg-gray-100 file:text-gray-700 hover:file:bg-gray-200">
                        </div>
                    </div>
                    
                    <!-- Status Messages -->
                    <div x-show="statusMessage" class="mt-4 p-4 rounded-lg" 
                         :class="statusMessage.success ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'">
                        <p x-text="statusMessage.text"></p>
                    </div>
                </div>
            </div>

            <!-- Recent Activities -->
            <div class="mt-8 max-w-5xl mx-auto">
                <div class="bg-white rounded-xl shadow-sm p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">最近のアクティビティ</h3>
                    <div class="space-y-3">
                        <template x-for="activity in recentActivities" :key="activity.id">
                            <div class="flex items-center justify-between py-2 border-b border-gray-100 last:border-0">
                                <div class="flex items-center">
                                    <div class="w-2 h-2 rounded-full mr-3" 
                                         :class="{
                                             'bg-blue-500': activity.type === 'plan',
                                             'bg-emerald-500': activity.type === 'rule',
                                             'bg-purple-500': activity.type === 'download'
                                         }"></div>
                                    <div>
                                        <p class="text-sm text-gray-900" x-text="activity.message"></p>
                                        <p class="text-xs text-gray-500" x-text="activity.time"></p>
                                    </div>
                                </div>
                                <span class="text-xs px-2 py-1 rounded-full" 
                                      :class="{
                                          'bg-blue-100 text-blue-700': activity.type === 'plan',
                                          'bg-emerald-100 text-emerald-700': activity.type === 'rule',
                                          'bg-purple-100 text-purple-700': activity.type === 'download'
                                      }"
                                      x-text="activity.label"></span>
                            </div>
                        </template>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        function adminMenu() {
            return {
                stats: {
                    plans: 0,
                    plansUpdated: 0,
                    rules: 0,
                    rulesRequired: 0,
                    downloads: 0,
                    downloadsMonth: 0,
                    faqs: 0,
                    faqCategories: 0,
                    users: 12,
                    activeUsers: 8,
                    admins: 1,
                    lastBackup: '-',
                    monthlyPV: 0
                },
                recentActivities: [],
                loading: false,
                statusMessage: null,

                async init() {
                    // Load stats from API or localStorage
                    await this.loadStats();
                    
                    // プラン更新イベントをリッスン
                    window.addEventListener('plans-updated', () => {
                        this.loadStats();
                    });
                    
                    // 統計更新イベントをリッスン
                    window.addEventListener('stats-updated', () => {
                        this.loadStats();
                    });
                },

                logout() {
                    if (confirm('ログアウトしますか？')) {
                        window.authManager.logout();
                    }
                },

                async loadStats() {
                    try {
                        // プラン統計（公開中のプランのみカウント - ホームページと一致させる）
                        const { data, error } = await window.supabase
                            .from('plans')
                            .select('*');

                        const publishedPlans = (data || []);
                        this.stats.plans = publishedPlans.length;
                        this.stats.plansUpdated = publishedPlans.filter(plan => {
                            if (!plan.updated_at) return false;
                            const updatedDate = new Date(plan.updated_at);
                            const thisMonth = new Date();
                            return updatedDate.getMonth() === thisMonth.getMonth() &&
                                   updatedDate.getFullYear() === thisMonth.getFullYear();
                        }).length;
                        
                        // ルール統計
                        const rulesData = localStorage.getItem('rules_categories_data');
                        if (rulesData) {
                            const rules = JSON.parse(rulesData);
                            let totalRules = 0;
                            let requiredRules = 0;
                            (rules.categories || []).forEach(cat => {
                                totalRules += (cat.rules || []).length;
                                requiredRules += (cat.rules || []).filter(r => r.importance === '必須').length;
                            });
                            this.stats.rules = totalRules;
                            this.stats.rulesRequired = requiredRules;
                        } else {
                            this.stats.rules = 0;
                            this.stats.rulesRequired = 0;
                        }
                        
                        // ダウンロード統計（ホームページと同じロジックに統一）
                        const downloadsData = localStorage.getItem('downloads_data');
                        if (downloadsData && downloadsData !== '{"categories":{}}') {
                            try {
                                const downloads = JSON.parse(downloadsData);
                                let totalFiles = 0;
                                
                                // 新しい形式（配列）のチェック
                                if (downloads.categories && Array.isArray(downloads.categories)) {
                                    downloads.categories.forEach(category => {
                                        if (category.files && Array.isArray(category.files)) {
                                            totalFiles += category.files.length;
                                        }
                                    });
                                }
                                // 古い形式（オブジェクト）のチェック（互換性のため）
                                else if (downloads.categories && typeof downloads.categories === 'object') {
                                    Object.keys(downloads.categories).forEach(categoryKey => {
                                        const cat = downloads.categories[categoryKey];
                                        // 新しい形式のfilesフィールド
                                        if (cat.files && Array.isArray(cat.files)) {
                                            totalFiles += cat.files.length;
                                        }
                                        // 古い形式のitemsフィールド
                                        else if (cat.items && Array.isArray(cat.items)) {
                                            totalFiles += cat.items.length;
                                        }
                                    });
                                }
                                
                                this.stats.downloads = totalFiles;
                                console.log('Downloads data:', downloads, 'Total files:', totalFiles);
                            } catch (e) {
                                console.error('Error parsing downloads data:', e);
                                this.stats.downloads = 0;
                            }
                        } else {
                            this.stats.downloads = 0;
                        }
                        
                        // FAQ統計
                        const faqData = localStorage.getItem('faq_data');
                        if (faqData) {
                            const faqs = JSON.parse(faqData);
                            this.stats.faqs = (faqs.faqs || faqs || []).length;
                            const faqArray = faqs.faqs || faqs || [];
                            const uniqueCategories = new Set(faqArray.map(f => f.category).filter(c => c));
                            this.stats.faqCategories = uniqueCategories.size;
                            console.log('FAQ data:', faqs, 'Total FAQs:', this.stats.faqs);
                        } else {
                            this.stats.faqs = 0;
                            this.stats.faqCategories = 0;
                        }
                        
                        // 管理者統計
                        const adminData = localStorage.getItem('admin_users_data');
                        if (adminData) {
                            const admins = JSON.parse(adminData);
                            this.stats.admins = (admins.users || admins || []).length;
                            console.log('Admin data:', admins, 'Total admins:', this.stats.admins);
                        } else {
                            this.stats.admins = 0;
                        }
                        
                        // バックアップ統計
                        const backupData = localStorage.getItem('system_backup_info');
                        if (backupData) {
                            const backup = JSON.parse(backupData);
                            this.stats.lastBackup = backup.lastBackup || '-';
                        } else {
                            this.stats.lastBackup = '-';
                        }
                    } catch (error) {
                        console.error('Failed to load stats:', error);
                    }
                },

                async quickAction(action) {
                    switch(action) {
                        case 'backup':
                            await this.performBackup();
                            break;
                        case 'export':
                            await this.exportData();
                            break;
                        case 'report':
                            lifeXAPI.showToast('月次レポートを生成中です', 'info');
                            break;
                        case 'settings':
                            lifeXAPI.showToast('システム設定を開きます', 'info');
                            break;
                    }
                },
                
                async performBackup() {
                    try {
                        lifeXAPI.showToast('バックアップを開始しました', 'info');

                        // Supabaseからプランデータを取得
                        const { data: plans } = await window.supabase
                            .from('plans')
                            .select('*');

                        // 全てのデータを収集
                        const backupData = {
                            timestamp: new Date().toISOString(),
                            plans: JSON.stringify({ plans: plans || [] }),
                            downloads: localStorage.getItem('downloads_data'),
                            rules: localStorage.getItem('rules_categories_data'),
                            faqs: localStorage.getItem('faq_data'),
                            admins: localStorage.getItem('admin_users_data')
                        };
                        
                        // バックアップファイルを生成してダウンロード
                        const dataStr = JSON.stringify(backupData, null, 2);
                        const dataBlob = new Blob([dataStr], {type: 'application/json'});
                        const url = URL.createObjectURL(dataBlob);
                        const link = document.createElement('a');
                        link.href = url;
                        link.download = `lifex-backup-${new Date().toISOString().split('T')[0]}.json`;
                        link.click();
                        URL.revokeObjectURL(url);
                        
                        // バックアップ情報を更新
                        const backupInfo = {
                            lastBackup: new Date().toLocaleString('ja-JP'),
                            totalSize: dataStr.length
                        };
                        localStorage.setItem('system_backup_info', JSON.stringify(backupInfo));
                        
                        // 統計を更新
                        this.stats.lastBackup = backupInfo.lastBackup;
                        
                        lifeXAPI.showToast('バックアップが完了しました', 'success');
                    } catch (error) {
                        console.error('Backup failed:', error);
                        lifeXAPI.showToast('バックアップに失敗しました', 'error');
                    }
                },
                
                async exportData() {
                    try {
                        lifeXAPI.showToast('データエクスポートを開始しました', 'info');

                        // CSVエクスポート用のプランデータを取得
                        const { data: plans, error } = await window.supabase
                            .from('plans')
                            .select('*');

                        if (error) throw error;

                        if (!plans || plans.length === 0) {
                            lifeXAPI.showToast('エクスポートするプランがありません', 'warning');
                            return;
                        }

                        // CSV形式に変換
                        const headers = ['プランID', '階数', '坪数', '間取り', '想定販売価格', '想定原価', '想定粗利', '更新日'];
                        const csvData = [
                            headers.join(','),
                            ...plans.map(plan => [
                                plan.id || '',
                                plan.building_floors == 1 ? '平屋' : plan.building_floors == 2 ? '2階建て' : '3階建て',
                                plan.tsubo || '',
                                plan.plan_name || '',
                                plan.sell_price ? Math.round(plan.sell_price / 10000) + '万円' : '',
                                plan.cost_price ? Math.round(plan.cost_price / 10000) + '万円' : '',
                                plan.gross_profit ? Math.round(plan.gross_profit / 10000) + '万円' : '',
                                plan.updated_at ? new Date(plan.updated_at).toLocaleDateString('ja-JP') : ''
                            ].join(','))
                        ].join('\n');
                        
                        // CSVファイルをダウンロード
                        const csvBlob = new Blob(['\uFEFF' + csvData], {type: 'text/csv;charset=utf-8'});
                        const csvUrl = URL.createObjectURL(csvBlob);
                        const link = document.createElement('a');
                        link.href = csvUrl;
                        link.download = `lifex-plans-${new Date().toISOString().split('T')[0]}.csv`;
                        link.click();
                        URL.revokeObjectURL(csvUrl);
                        
                        lifeXAPI.showToast('データエクスポートが完了しました', 'success');
                    } catch (error) {
                        console.error('Export failed:', error);
                        lifeXAPI.showToast('データエクスポートに失敗しました', 'error');
                    }
                },

                // 新しいバックアップ機能（IndexedDB対応）
                async createBackup() {
                    this.loading = true;
                    this.statusMessage = null;
                    
                    try {
                        const result = await lifeXAPI.createBackup();
                        this.statusMessage = {
                            success: result.success,
                            text: result.message
                        };
                        
                        if (result.success) {
                            // 統計情報を更新
                            const backupInfo = {
                                lastBackup: new Date().toLocaleString('ja-JP')
                            };
                            localStorage.setItem('system_backup_info', JSON.stringify(backupInfo));
                            await this.loadStats();
                        }
                    } catch (error) {
                        console.error('Backup failed:', error);
                        this.statusMessage = {
                            success: false,
                            text: 'バックアップ作成中にエラーが発生しました: ' + error.message
                        };
                    } finally {
                        this.loading = false;
                    }
                },

                // リストア機能
                async handleRestoreFile(event) {
                    const file = event.target.files[0];
                    if (!file) return;

                    if (!confirm('データを復元すると現在のデータが上書きされます。続行しますか？')) {
                        event.target.value = '';
                        return;
                    }

                    this.loading = true;
                    this.statusMessage = null;

                    try {
                        const result = await lifeXAPI.restoreFromBackup(file);
                        this.statusMessage = {
                            success: result.success,
                            text: result.message
                        };
                        
                        if (result.success) {
                            // 統計情報を更新
                            setTimeout(() => {
                                window.location.reload();
                            }, 2000);
                        }
                    } catch (error) {
                        console.error('Restore failed:', error);
                        this.statusMessage = {
                            success: false,
                            text: 'データ復元中にエラーが発生しました: ' + error.message
                        };
                    } finally {
                        this.loading = false;
                        event.target.value = '';
                    }
                }
            }
        }
    </script>
</body>
</html>