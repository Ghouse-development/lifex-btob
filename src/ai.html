<!DOCTYPE html>
<html lang="ja" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI„Ç¢„Ç∑„Çπ„Çø„É≥„Éà | LIFE X Âä†ÁõüÂ∫óÂ∞ÇÁî®„Çµ„Ç§„Éà</title>
    <!-- Tailwind CSS (Production Build) -->
    <link rel="stylesheet" href="/assets/tailwind.css">

    <link href="./styles/main.css" rel="stylesheet">
</head>
<body class="h-full bg-gray-50">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <a href="/" class="text-xl font-bold text-gray-900 hover:text-gray-700">LIFE X</a>
                    <span class="ml-2 px-2 py-1 bg-primary-100 text-primary-800 text-xs rounded-full">AI„Ç¢„Ç∑„Çπ„Çø„É≥„Éà</span>
                </div>
                <nav class="hidden md:flex space-x-8">
                    <a href="/" class="nav-link">„Éõ„Éº„É†</a>
                    <a href="/matrix.html" class="nav-link">ÈñìÂèñ„Éû„Éà„É™„ÉÉ„ÇØ„Çπ</a>
                    <a href="/plans.html" class="nav-link">„Éó„É©„É≥‰∏ÄË¶ß</a>
                    <a href="/rules.html" class="nav-link">„É´„Éº„É´„Éª„Ç¨„Ç§„Éâ„É©„Ç§„É≥</a>
                    <a href="/downloads.html" class="nav-link">„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ</a>
                    <a href="/ai.html" class="nav-link active">AI„Ç¢„Ç∑„Çπ„Çø„É≥„Éà</a>
                </nav>
                <div class="md:hidden" x-data="{ mobileMenuOpen: false }">
                    <button @click="mobileMenuOpen = !mobileMenuOpen" type="button" class="text-gray-500 hover:text-gray-600 focus:outline-none">
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                    </button>
                    
                    <!-- Mobile Menu -->
                    <div x-show="mobileMenuOpen" class="absolute top-16 right-4 bg-white shadow-lg rounded-lg border p-4 z-50 min-w-48">
                        <a href="/" class="nav-link block">„Éõ„Éº„É†</a>
                        <a href="/matrix.html" class="nav-link block">ÈñìÂèñ„Éû„Éà„É™„ÉÉ„ÇØ„Çπ</a>
                        <a href="/plans.html" class="nav-link block">„Éó„É©„É≥‰∏ÄË¶ß</a>
                        <a href="/rules.html" class="nav-link block">„É´„Éº„É´„Éª„Ç¨„Ç§„Éâ„É©„Ç§„É≥</a>
                        <a href="/downloads.html" class="nav-link block">„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ</a>
                        <a href="/ai.html" class="nav-link block">AI„Ç¢„Ç∑„Çπ„Çø„É≥„Éà</a>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div x-data="aiAssistant()" x-init="init()">
        <!-- Breadcrumb -->
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <nav class="breadcrumb">
                <a href="/">„Éõ„Éº„É†</a>
                <span class="breadcrumb-separator">></span>
                <span class="text-gray-900">AI„Ç¢„Ç∑„Çπ„Çø„É≥„Éà</span>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 pb-8">
            <!-- Page Header -->
            <div class="text-center mb-8">
                <div class="inline-flex items-center justify-center w-20 h-20 bg-gradient-to-r from-violet-500 to-violet-600 rounded-full mb-4">
                    <span class="text-4xl">ü§ñ</span>
                </div>
                <h1 class="text-3xl font-bold text-gray-900 mb-4">LIFE X AI„Ç¢„Ç∑„Çπ„Çø„É≥„Éà</h1>
                <p class="text-lg text-gray-600">‰ΩèÂÆÖÂª∫ÁØâ„ÉªLIFE X„Å´Èñ¢„Åô„Çã„ÅîË≥™Âïè„Å´AI„Åå„ÅäÁ≠î„Åà„Åó„Åæ„Åô</p>
            </div>

            <!-- Suggested Topics -->
            <div class="mb-6">
                <h3 class="text-sm font-semibold text-gray-600 mb-3">„Çà„Åè„ÅÇ„ÇãË≥™Âïè„Çí„ÇØ„É™„ÉÉ„ÇØÔºö</h3>
                <div class="flex flex-wrap gap-2">
                    <button @click="askSuggestion('LIFE X„ÅÆÊ®ôÊ∫ñ„Éó„É©„É≥„Å´„Å§„ÅÑ„Å¶Êïô„Åà„Å¶„Åè„Å†„Åï„ÅÑ')" 
                            class="px-4 py-2 bg-white border border-gray-300 rounded-full text-sm hover:bg-gray-50 transition-colors">
                        Ê®ôÊ∫ñ„Éó„É©„É≥„Å´„Å§„ÅÑ„Å¶
                    </button>
                    <button @click="askSuggestion('ËÄêÈúáÁ≠âÁ¥ö3„ÅÆË©≥Á¥∞„ÇíÊïô„Åà„Å¶„Åè„Å†„Åï„ÅÑ')" 
                            class="px-4 py-2 bg-white border border-gray-300 rounded-full text-sm hover:bg-gray-50 transition-colors">
                        ËÄêÈúáÁ≠âÁ¥ö„Å´„Å§„ÅÑ„Å¶
                    </button>
                    <button @click="askSuggestion('Â∑•‰∫ãÊúüÈñì„ÅØ„Å©„ÅÆ„Åè„Çâ„ÅÑ„Åß„Åô„ÅãÔºü')" 
                            class="px-4 py-2 bg-white border border-gray-300 rounded-full text-sm hover:bg-gray-50 transition-colors">
                        Â∑•‰∫ãÊúüÈñì
                    </button>
                    <button @click="askSuggestion('„Ç™„Éó„Ç∑„Éß„É≥Ë®≠ÂÇô„Å´„ÅØ„Å©„Çì„Å™„ÇÇ„ÅÆ„Åå„ÅÇ„Çä„Åæ„Åô„ÅãÔºü')" 
                            class="px-4 py-2 bg-white border border-gray-300 rounded-full text-sm hover:bg-gray-50 transition-colors">
                        „Ç™„Éó„Ç∑„Éß„É≥Ë®≠ÂÇô
                    </button>
                    <button @click="askSuggestion('‰æ°Ê†º„ÅÆÁõÆÂÆâ„ÇíÊïô„Åà„Å¶„Åè„Å†„Åï„ÅÑ')" 
                            class="px-4 py-2 bg-white border border-gray-300 rounded-full text-sm hover:bg-gray-50 transition-colors">
                        ‰æ°Ê†º„ÅÆÁõÆÂÆâ
                    </button>
                </div>
            </div>

            <!-- Chat Interface -->
            <div class="card">
                <!-- Chat Messages -->
                <div class="bg-gray-50 rounded-lg h-[500px] overflow-y-auto p-6 mb-4" x-ref="chatContainer">
                    <template x-for="message in messages" :key="message.id">
                        <div class="mb-6">
                            <div :class="message.role === 'user' ? 'flex justify-end' : 'flex justify-start'">
                                <div :class="message.role === 'user' ? 'max-w-2xl' : 'max-w-3xl'">
                                    <div class="flex items-start space-x-3">
                                        <div x-show="message.role === 'assistant'" class="flex-shrink-0 w-8 h-8 bg-violet-500 rounded-full flex items-center justify-center">
                                            <span class="text-white text-sm">AI</span>
                                        </div>
                                        <div class="flex-1">
                                            <div :class="message.role === 'user' ? 'bg-primary-600 text-white rounded-2xl rounded-tr-sm' : 'bg-white border border-gray-200 rounded-2xl rounded-tl-sm'" 
                                                 class="px-5 py-3 shadow-sm">
                                                <div x-html="message.content" class="text-sm leading-relaxed"></div>
                                            </div>
                                            <div class="text-xs text-gray-500 mt-1" :class="message.role === 'user' ? 'text-right' : 'text-left'">
                                                <span x-text="message.timestamp"></span>
                                            </div>
                                        </div>
                                        <div x-show="message.role === 'user'" class="flex-shrink-0 w-8 h-8 bg-gray-400 rounded-full flex items-center justify-center">
                                            <span class="text-white text-sm">You</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </template>
                    
                    <!-- Typing Indicator -->
                    <div x-show="isTyping" class="mb-6">
                        <div class="flex justify-start">
                            <div class="flex items-start space-x-3">
                                <div class="flex-shrink-0 w-8 h-8 bg-violet-500 rounded-full flex items-center justify-center">
                                    <span class="text-white text-sm">AI</span>
                                </div>
                                <div class="bg-white border border-gray-200 rounded-2xl rounded-tl-sm px-5 py-3 shadow-sm">
                                    <div class="flex space-x-2">
                                        <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0ms"></div>
                                        <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 150ms"></div>
                                        <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 300ms"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Input Area -->
                <div class="border-t border-gray-200 pt-4">
                    <div class="flex space-x-3">
                        <input 
                            type="text" 
                            x-model="input"
                            @keyup.enter="sendMessage()"
                            placeholder="Ë≥™Âïè„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ..." 
                            class="form-input flex-1"
                            :disabled="isTyping">
                        <button 
                            @click="sendMessage()" 
                            :disabled="isTyping || !input.trim()"
                            class="btn-primary px-6">
                            <span x-show="!isTyping">ÈÄÅ‰ø°</span>
                            <span x-show="isTyping">
                                <svg class="animate-spin h-5 w-5" viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"></circle>
                                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                </svg>
                            </span>
                        </button>
                    </div>
                    <div class="mt-3 text-xs text-gray-500">
                        ‚Äª AI„Ç¢„Ç∑„Çπ„Çø„É≥„Éà„ÅØ‰∏ÄËà¨ÁöÑ„Å™ÊÉÖÂ†±Êèê‰æõ„ÇíË°å„ÅÑ„Åæ„Åô„ÄÇÂÄãÂà•„ÅÆÊ°à‰ª∂„Å´„Å§„ÅÑ„Å¶„ÅØÊãÖÂΩìËÄÖ„Å´„ÅîÁõ∏Ë´á„Åè„Å†„Åï„ÅÑ„ÄÇ
                    </div>
                </div>
            </div>

            <!-- Information Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-8">
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <h3 class="font-semibold text-blue-900 mb-2">üí° „Éí„É≥„Éà</h3>
                    <p class="text-sm text-blue-800">
                        ÂÖ∑‰ΩìÁöÑ„Å™Ë≥™Âïè„Çí„Åô„Çã„Å®„ÄÅ„Çà„ÇäË©≥Á¥∞„Å™ÂõûÁ≠î„ÅåÂæó„Çâ„Çå„Åæ„Åô„ÄÇ‰æãÔºö„Äå30Âù™„ÅÆÊ®ôÊ∫ñ„Éó„É©„É≥„ÅÆÁâπÂæ¥„ÅØÔºü„Äç
                    </p>
                </div>
                <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                    <h3 class="font-semibold text-green-900 mb-2">üìû „ÅäÂïè„ÅÑÂêà„Çè„Åõ</h3>
                    <p class="text-sm text-green-800">
                        Ë©≥Á¥∞„Å™ÊäÄË°ì„Çµ„Éù„Éº„Éà„ÅåÂøÖË¶Å„Å™Â†¥Âêà„ÅØ„ÄÅ„Ç´„Çπ„Çø„Éû„Éº„Çµ„Éù„Éº„Éà„Åæ„Åß„ÅîÈÄ£Áµ°„Åè„Å†„Åï„ÅÑ„ÄÇ
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        function aiAssistant() {
            return {
                messages: [],
                input: '',
                isTyping: false,
                knowledgeBase: {
                    '„Éó„É©„É≥': {
                        keywords: ['„Éó„É©„É≥', 'ÈñìÂèñ„Çä', 'Ê®ôÊ∫ñ', '„Ç´„Çπ„Çø„Éû„Ç§„Ç∫'],
                        response: 'LIFE X„Åß„ÅØ156Á®ÆÈ°û„ÅÆÊ®ôÊ∫ñ„Éó„É©„É≥„Çí„ÅîÁî®ÊÑè„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇÂêÑ„Éó„É©„É≥„ÅØÂù™Êï∞„ÄÅÈñìÂè£„ÄÅÂ••Ë°å„Åç„Å´„Çà„Å£„Å¶ÂàÜÈ°û„Åï„Çå„ÄÅ„ÅäÂÆ¢Êßò„ÅÆ„Éã„Éº„Ç∫„Å´Âêà„Çè„Åõ„Å¶ÈÅ∏Êäû„Åß„Åç„Åæ„Åô„ÄÇÂü∫Êú¨ÊßãÈÄ†„ÇíÁ∂≠ÊåÅ„Åó„Å™„Åå„Çâ„ÄÅÂÜÖË£Ö„ÇÑË®≠ÂÇô„ÅÆ„Ç´„Çπ„Çø„Éû„Ç§„Ç∫„ÇÇÂèØËÉΩ„Åß„Åô„ÄÇ'
                    },
                    'ËÄêÈúá': {
                        keywords: ['ËÄêÈúá', 'Âú∞Èúá', 'ÊßãÈÄ†', 'ÂÆâÂÖ®'],
                        response: 'LIFE X„ÅÆÂÖ®‰ΩèÂÆÖ„ÅØ„ÄÅÊ®ôÊ∫ñ‰ªïÊßò„ÅßËÄêÈúáÁ≠âÁ¥ö3ÔºàÊúÄÈ´òÁ≠âÁ¥öÔºâ„ÇíÁ¢∫‰øù„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ„Åì„Çå„ÅØÂª∫ÁØâÂü∫Ê∫ñÊ≥ï„ÅÆ1.5ÂÄç„ÅÆÂú∞ÈúáÂäõ„Å´ËÄê„Åà„ÇãË®≠Ë®à„Åß„ÄÅÊ•µ„ÇÅ„Å¶Á®Ä„Å™Âú∞Èúá„Åß„ÇÇÂÄíÂ£ä„ÉªÂ¥©Â£ä„Åó„Å™„ÅÑÂº∑Â∫¶„ÇíÊåÅ„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ'
                    },
                    'Â∑•Êúü': {
                        keywords: ['Â∑•Êúü', 'ÊúüÈñì', 'Â∑•‰∫ã', 'ÂºïÊ∏°„Åó', 'ÁùÄÂ∑•'],
                        response: 'Ê®ôÊ∫ñÁöÑ„Å™Â∑•‰∫ãÊúüÈñì„ÅØÁùÄÂ∑•„Åã„ÇâÂºïÊ∏°„Åó„Åæ„ÅßÁ¥Ñ4ÔΩû5„É∂Êúà„Åß„Åô„ÄÇÂÜÖË®≥„ÅØ„ÄÅÂü∫Á§éÂ∑•‰∫ãÔºöÁ¥Ñ1„É∂Êúà„ÄÅË∫Ø‰ΩìÂ∑•‰∫ãÔºöÁ¥Ñ1„É∂Êúà„ÄÅÂÜÖÂ§ñË£ÖÂ∑•‰∫ãÔºöÁ¥Ñ1.5„É∂Êúà„ÄÅË®≠ÂÇôÂ∑•‰∫ã„ÉªÂÆå‰∫ÜÊ§úÊüªÔºöÁ¥Ñ0.5„É∂Êúà„Å®„Å™„Çä„Åæ„Åô„ÄÇ'
                    },
                    '‰æ°Ê†º': {
                        keywords: ['‰æ°Ê†º', 'Ë≤ªÁî®', 'ÈáëÈ°ç', '‰∫àÁÆó', 'Âù™Âçò‰æ°'],
                        response: 'LIFE X„ÅÆ‰æ°Ê†º„ÅØ„ÄÅÂù™Êï∞„ÇÑ‰ªïÊßò„Å´„Çà„ÇäÁï∞„Å™„Çä„Åæ„Åô„Åå„ÄÅ‰∏ÄËà¨ÁöÑ„Å´Âù™Âçò‰æ°60ÔΩû80‰∏áÂÜÜ„ÅåÁõÆÂÆâ„Åß„Åô„ÄÇ„Åì„ÅÆ‰æ°Ê†º„Å´„ÅØÂü∫Êú¨‰ªïÊßò„ÅåÂê´„Åæ„Çå„Å¶„Åä„Çä„ÄÅ„Ç™„Éó„Ç∑„Éß„É≥ËøΩÂä†„Å´„Çà„ÇäÂ§âÂãï„Åó„Åæ„Åô„ÄÇË©≥Á¥∞„Å™Ë¶ãÁ©ç„Çä„ÅØÂÄãÂà•„Å´„ÅîÁõ∏Ë´á„Åè„Å†„Åï„ÅÑ„ÄÇ'
                    },
                    '„Ç™„Éó„Ç∑„Éß„É≥': {
                        keywords: ['„Ç™„Éó„Ç∑„Éß„É≥', 'ËøΩÂä†', 'Ë®≠ÂÇô', 'Â§™ÈôΩÂÖâ', 'evoltz'],
                        response: '‰∏ª„Å™„Ç™„Éó„Ç∑„Éß„É≥„Å®„Åó„Å¶„ÄÅÂ§™ÈôΩÂÖâÁô∫Èõª„Ç∑„Çπ„ÉÜ„É†„ÄÅevoltzÔºàV2HÂØæÂøúÔºâ„ÄÅ„Çπ„Éû„Éº„Éà„Éõ„Éº„É†Ê©üËÉΩ„ÄÅÂ∫äÊöñÊàø„ÄÅÈÄ†‰ΩúÂÆ∂ÂÖ∑„Å™„Å©„Çí„ÅîÁî®ÊÑè„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇÁúÅ„Ç®„Éç„ÇÑÂø´ÈÅ©ÊÄß„ÇíÈ´ò„ÇÅ„ÇãÊßò„ÄÖ„Å™ÈÅ∏ÊäûËÇ¢„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ'
                    },
                    '‰øùË®º': {
                        keywords: ['‰øùË®º', '„Ç¢„Éï„Çø„Éº', '„É°„É≥„ÉÜ„Éä„É≥„Çπ', 'ÁÇπÊ§ú'],
                        response: 'LIFE X„Åß„ÅØ„ÄÅÊßãÈÄ†Ë∫Ø‰Ωì„ÉªÈò≤Ê∞¥„Å´10Âπ¥‰øùË®º„ÇíÊèê‰æõ„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ„Åæ„Åü„ÄÅ1Âπ¥„ÄÅ2Âπ¥„ÄÅ5Âπ¥„ÄÅ10Âπ¥„ÅÆÂÆöÊúüÁÇπÊ§ú„ÇíÂÆüÊñΩ„Åó„ÄÅÈï∑Êúü„Å´„Çè„Åü„Å£„Å¶ÂÆâÂøÉ„Åó„Å¶„Åä‰Ωè„Åæ„ÅÑ„ÅÑ„Åü„Å†„Åë„Çã„Çµ„Éù„Éº„Éà‰ΩìÂà∂„ÇíÊï¥„Åà„Å¶„ÅÑ„Åæ„Åô„ÄÇ'
                    },
                    'ÊÄßËÉΩ': {
                        keywords: ['ÊÄßËÉΩ', 'Êñ≠ÁÜ±', 'ÁúÅ„Ç®„Éç', 'Ê∞óÂØÜ'],
                        response: 'LIFE X„ÅÆ‰ΩèÂÆÖ„ÅØ„ÄÅÈ´òÊñ≠ÁÜ±„ÉªÈ´òÊ∞óÂØÜË®≠Ë®à„Å´„Çà„ÇäÂÑ™„Çå„ÅüÁúÅ„Ç®„ÉçÊÄßËÉΩ„ÇíÂÆüÁèæ„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇZEHÂü∫Ê∫ñ„Å´ÂØæÂøúÂèØËÉΩ„Åß„ÄÅÂπ¥Èñì„ÇíÈÄö„Åò„Å¶Âø´ÈÅ©„Å™ÂÆ§ÂÜÖÁí∞Â¢É„ÇíÁ∂≠ÊåÅ„Åó„Å™„Åå„Çâ„ÄÅÂÖâÁÜ±Ë≤ª„ÅÆÂâäÊ∏õ„Å´„ÇÇË≤¢ÁåÆ„Åó„Åæ„Åô„ÄÇ'
                    }
                },

                init() {
                    this.messages = [
                        {
                            id: Date.now(),
                            role: 'assistant',
                            content: '„Åì„Çì„Å´„Å°„ÅØÔºÅLIFE X AI„Ç¢„Ç∑„Çπ„Çø„É≥„ÉàÔºàPowered by GeminiÔºâ„Åß„Åô„ÄÇ<br>‰ΩèÂÆÖÂª∫ÁØâ„ÇÑLIFE X„Å´Èñ¢„Åô„Çã„ÅîË≥™Âïè„Çí„ÅäÊ∞óËªΩ„Å´„Å©„ÅÜ„Åû„ÄÇ<br><br>„Éó„É©„É≥„ÄÅ‰ªïÊßò„ÄÅË®≠Ë®à„ÄÅÊñΩÂ∑•„Å™„Å©„ÄÅ„Å™„Çì„Åß„ÇÇ„ÅäËÅû„Åç„Åè„Å†„Åï„ÅÑÔºÅ',
                            timestamp: this.getTimestamp()
                        }
                    ];
                },

                async sendMessage() {
                    if (!this.input.trim() || this.isTyping) return;

                    // Add user message
                    this.messages.push({
                        id: Date.now(),
                        role: 'user',
                        content: this.input,
                        timestamp: this.getTimestamp()
                    });

                    const question = this.input;
                    this.input = '';
                    this.isTyping = true;

                    // Scroll to bottom
                    this.$nextTick(() => {
                        this.scrollToBottom();
                    });

                    try {
                        // Call Gemini API via Vercel Function
                        const response = await this.callGeminiAPI(question);

                        this.messages.push({
                            id: Date.now(),
                            role: 'assistant',
                            content: this.formatResponse(response),
                            timestamp: this.getTimestamp()
                        });
                    } catch (error) {
                        console.error('AI response error:', error);

                        // Fallback to knowledge base on error
                        const fallbackResponse = this.generateResponse(question);
                        this.messages.push({
                            id: Date.now(),
                            role: 'assistant',
                            content: fallbackResponse + '<br><br><small class="text-gray-500">‚Äª AIÊé•Á∂ö„Ç®„É©„Éº„ÅÆ„Åü„ÇÅ„ÄÅ„Éä„É¨„ÉÉ„Ç∏„Éô„Éº„Çπ„Åã„ÇâÂõûÁ≠î„Åó„Å¶„ÅÑ„Åæ„Åô</small>',
                            timestamp: this.getTimestamp()
                        });
                    }

                    this.isTyping = false;

                    this.$nextTick(() => {
                        this.scrollToBottom();
                    });
                },

                async callGeminiAPI(message) {
                    // Get conversation history (last 5 messages)
                    const history = this.messages
                        .slice(-10) // Last 10 messages
                        .map(msg => ({
                            role: msg.role,
                            content: msg.content.replace(/<[^>]*>/g, '') // Strip HTML
                        }));

                    const response = await fetch('/api/gemini-chat', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            message: message,
                            history: history
                        })
                    });

                    if (!response.ok) {
                        throw new Error('API request failed');
                    }

                    const data = await response.json();

                    if (!data.success) {
                        throw new Error(data.error || 'Unknown error');
                    }

                    return data.response;
                },

                formatResponse(text) {
                    // Convert markdown-like formatting to HTML
                    let formatted = text
                        .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>') // Bold
                        .replace(/\*(.+?)\*/g, '<em>$1</em>') // Italic
                        .replace(/\n/g, '<br>') // Line breaks
                        .replace(/„Äê(.+?)„Äë/g, '<strong>$1</strong>'); // Japanese brackets to bold

                    return formatted;
                },

                askSuggestion(question) {
                    this.input = question;
                    this.sendMessage();
                },

                generateResponse(question) {
                    const lowerQuestion = question.toLowerCase();
                    
                    // Check knowledge base for matching topics
                    for (const [topic, data] of Object.entries(this.knowledgeBase)) {
                        for (const keyword of data.keywords) {
                            if (lowerQuestion.includes(keyword)) {
                                return data.response;
                            }
                        }
                    }
                    
                    // Default responses for common patterns
                    if (lowerQuestion.includes('„Åì„Çì„Å´„Å°„ÅØ') || lowerQuestion.includes('„ÅØ„Åò„ÇÅ„Åæ„Åó„Å¶')) {
                        return '„Åì„Çì„Å´„Å°„ÅØÔºÅLIFE X„Å´„Å§„ÅÑ„Å¶„Å©„ÅÆ„Çà„ÅÜ„Å™„ÅîË≥™Âïè„Åå„Åî„Åñ„ÅÑ„Åæ„Åô„ÅãÔºü„Éó„É©„É≥„ÄÅ‰æ°Ê†º„ÄÅÂ∑•Êúü„ÄÅÊÄßËÉΩ„Å™„Å©„ÄÅ„ÅäÊ∞óËªΩ„Å´„ÅäÂ∞ã„Å≠„Åè„Å†„Åï„ÅÑ„ÄÇ';
                    }
                    
                    if (lowerQuestion.includes('„ÅÇ„Çä„Åå„Å®„ÅÜ')) {
                        return '„Å©„ÅÜ„ÅÑ„Åü„Åó„Åæ„Åó„Å¶ÔºÅ‰ªñ„Å´„ÇÇ„ÅîË≥™Âïè„Åå„Åî„Åñ„ÅÑ„Åæ„Åó„Åü„Çâ„ÄÅ„ÅäÊ∞óËªΩ„Å´„ÅäËÅû„Åç„Åè„Å†„Åï„ÅÑ„ÄÇ';
                    }
                    
                    // Fallback response
                    return `„Äå${question}„Äç„Å´„Å§„ÅÑ„Å¶„ÅÆ„ÅîË≥™Âïè„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô„ÄÇ<br><br>` +
                           '„Çà„ÇäË©≥Á¥∞„Å™ÊÉÖÂ†±„Å´„Å§„ÅÑ„Å¶„ÅØ„ÄÅ‰ª•‰∏ã„Çí„ÅîÁ¢∫Ë™ç„Åè„Å†„Åï„ÅÑÔºö<br>' +
                           '‚Ä¢ „Éó„É©„É≥‰∏ÄË¶ß„Éö„Éº„Ç∏„ÅßÂÖ∑‰ΩìÁöÑ„Å™„Éó„É©„É≥„Çí„ÅîË¶ß„ÅÑ„Åü„Å†„Åë„Åæ„Åô<br>' +
                           '‚Ä¢ „ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Éö„Éº„Ç∏„Åã„ÇâË©≥Á¥∞Ë≥áÊñô„ÇíÂÖ•Êâã„Åß„Åç„Åæ„Åô<br>' +
                           '‚Ä¢ ÂÄãÂà•„ÅÆ„ÅîÁõ∏Ë´á„ÅØÊãÖÂΩìËÄÖ„Åæ„Åß„ÅäÂïè„ÅÑÂêà„Çè„Åõ„Åè„Å†„Åï„ÅÑ<br><br>' +
                           '‰ªñ„Å´„ÅîË≥™Âïè„ÅØ„Åî„Åñ„ÅÑ„Åæ„Åô„ÅãÔºü';
                },

                scrollToBottom() {
                    this.$refs.chatContainer.scrollTop = this.$refs.chatContainer.scrollHeight;
                },

                getTimestamp() {
                    const now = new Date();
                    return now.toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' });
                }
            }
        }
    </script>

    <!-- Alpine.js -->
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <!-- Maintenance Button - Fixed Top Right -->
    <div class="fixed top-4 right-4 z-50">
        <button onclick="window.location.href='/admin.html'" 
                class="bg-white text-gray-400 p-2 rounded-lg shadow-sm hover:bg-gray-50 hover:text-gray-600 transition-all duration-300 opacity-70 hover:opacity-100 border border-gray-200" 
                title="„É°„É≥„ÉÜ„Éä„É≥„Çπ">
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"></path>
            </svg>
        </button>
    </div>
</body>
</html>